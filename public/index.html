<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NWP Tourism Portal</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>
  <header>
    <div class="logo">NWP Tourism</div>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/assets.html">Tourism Assets</a></li>
        <li><a href="/analysis.html">Gap Analysis</a></li>
        <li><a href="/recommendations.html">Recommendations</a></li>
        <li><a href="/about.html">About</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <section class="hero"
      style="background-image: url('https://storage.googleapis.com/gweb-cloudblog-publish/images/sri-lanka-GET.2e16d0ba.fill-1600x800.jpg');">
      <div class="hero-text">
        <h1>Discover the North Western Province</h1>
        <p>A data-driven approach to enhancing tourism potential.</p>
        <a class="cta-button" href="/assets.html">View Interactive Map</a>
      </div>
    </section>

    <section id="overview">
      <h2>Welcome to the Portal</h2>
      <p>This portal provides analytical tools and data to support sustainable tourism development in Sri Lanka's North
        Western Province.</p>
    </section>

    <section id="interactive-section">
      <div class="map-container">
        <h2>Click on the Map to Contribute</h2>
        <p>Click a location on the map to get its coordinates for a new asset.</p>
        <div id="map" style="height: 580px; border-radius: 8px; border: 2px solid #ddd; cursor: crosshair;"></div>
      </div>

      <div class="form-container sidebar">
        <h3>Contribute a Single Asset</h3>
        <form id="asset-upload-form">
          <label for="name">Asset Name:</label>
          <input type="text" id="name" name="name" required />
          <label for="category">Category:</label>
          <select id="category" name="category" required>
            <option value="" disabled selected>Select a Category</option>
            <option value="religious">Religious</option>
            <option value="heritage">Heritage</option>
            <option value="nature">Nature / Eco-Spot</option>
            <option value="accommodation">Accommodation</option>
            <option value="urban">Urban / Attraction</option>
          </select>
          <label for="description">Description:</label>
          <textarea id="description" name="description" rows="3" required></textarea>
          <label for="lat">Latitude:</label>
          <input type="text" id="lat" name="lat" placeholder="Click map or enter manually" required />
          <label for="lng">Longitude:</label>
          <input type="text" id="lng" name="lng" placeholder="Click map or enter manually" required />
          <label for="dataFile">Select Image:</label>
          <input type="file" id="dataFile" name="dataFile" accept="image/*" />
          <button type="submit">Upload Single Asset</button>
        </form>
        <p id="upload-status"></p>
      </div>
    </section>

    <!-- This section now contains both the analysis and the bulk upload -->
    <section class="summary-section">
      <!-- CHANGED: Restructured Gap Analysis section -->
      <div class="sidebar analysis-preview-card">
        <h3>Asset Count by Category</h3>
        <ul id="gap-analysis-list">
          <!-- Analysis data will be loaded here by upload.js -->
          <li>Loading analysis...</li>
        </ul>
      </div>

      <!-- CHANGED: Added a new class for a smaller sidebar -->
      <div class="sidebar bulk-upload-sidebar">
        <h3>Bulk Upload (For Admins)</h3>
        <form id="geojson-upload-form">
          <p>Upload a complete GeoJSON file of tourism assets for bulk data import.</p>
          <label for="geojsonFile">Select GeoJSON file:</label>
          <input type="file" id="geojsonFile" name="geojsonFile" accept=".geojson,.json" required />
          <button type="submit">Upload Data</button>
        </form>
        <p id="geojson-upload-status"></p>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="/js/upload.js"></script>
  <script>
    // This script for the homepage map remains the same
    const map = L.map('map').setView([7.8731, 80.7718], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18, attribution: 'Â© OpenStreetMap contributors' }).addTo(map);
    let marker = null;
    async function loadBoundary() { try { const response = await fetch('/data/nwp_boundary.geojson'); const data = await response.json(); const boundaryLayer = L.geoJSON(data, { style: { color: 'var(--primary-color)', weight: 2.5, opacity: 0.8, fillColor: 'var(--primary-color)', fillOpacity: 0.1, dashArray: '5, 5' } }).addTo(map); map.fitBounds(boundaryLayer.getBounds()); } catch (err) { console.error('Failed to load boundary file:', err); } }
    loadBoundary();
    map.on('click', function (e) { const lat = e.latlng.lat.toFixed(6); const lng = e.latlng.lng.toFixed(6); document.getElementById('lat').value = lat; document.getElementById('lng').value = lng; if (marker) { map.removeLayer(marker); } marker = L.circleMarker(e.latlng, { radius: 8, fillColor: "var(--secondary-color)", color: "#fff", weight: 2, opacity: 1, fillOpacity: 0.9 }).addTo(map); marker.bindPopup(`Selected: ${lat}, ${lng}`).openPopup(); });
  </script>
</body>

</html>